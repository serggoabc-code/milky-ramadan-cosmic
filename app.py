import streamlit as st
import google.generativeai as genai

# --- 1. –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´ ---
st.set_page_config(page_title="Milky School AI", page_icon="ü•õ", layout="wide")

# --- 2. –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ú–û–ó–ì–£ (–°–¢–ê–ë–ò–õ–¨–ù–´–ô –ú–ï–¢–û–î) ---
try:
    genai.configure(api_key=st.secrets["GOOGLE_API_KEY"])
except Exception as e:
    st.error(f"–û—à–∏–±–∫–∞ –∫–ª—é—á–∞ API: {e}")
    st.stop()

# --- 3. –ò–ù–¢–ï–†–§–ï–ô–° (–ë–û–ö–û–í–ê–Ø –ü–ê–ù–ï–õ–¨) ---
with st.sidebar:
    st.image("https://cdn-icons-png.flaticon.com/512/2405/2405451.png", width=100)
    st.title("–ù–∞—Å—Ç—Ä–æ–π–∫–∏ –ú–∏–ª–∫–∏")
    
    task_type = st.selectbox(
        "–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:",
        ["–õ–∞–±–∏—Ä–∏–Ω—Ç üåÄ", "–ö—Ä–æ—Å—Å–≤–æ—Ä–¥ üìù", "–†–∞—Å–∫—Ä–∞—Å–∫–∞ üé®", "–°–æ–µ–¥–∏–Ω–∏ –ø–∞—Ä—ã üîó", "–õ–æ–≥–∏–∫–∞ üß†"]
    )
    
    difficulty = st.select_slider("–°–ª–æ–∂–Ω–æ—Å—Ç—å:", options=["–ú–∞–ª—ã—à–∏ (3-5)", "–î–µ—Ç–∏ (6-9)", "–ü–æ–¥—Ä–æ—Å—Ç–∫–∏ (10+)"])

# --- 4. –ì–õ–ê–í–ù–´–ô –≠–ö–†–ê–ù ---
st.title("üöÄ –ö–æ—Å–º–∏—á–µ—Å–∫–∞—è –®–∫–æ–ª–∞ Milky")
st.markdown("### –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä –∑–∞–¥–∞–Ω–∏–π –Ω–∞ –†–∞–º–∞–¥–∞–Ω")
st.info("–ò—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –º–æ–¥–µ–ª—å: Gemini 1.5 Flash (–°–∞–º–∞—è –±—ã—Å—Ç—Ä–∞—è)")

user_topic = st.text_input("–¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è:", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ—Ä–ø–µ–Ω–∏–µ –≤ –∫–æ—Å–º–æ—Å–µ –∏–ª–∏ –ò—Ñ—Ç–∞—Ä –Ω–∞ –ú–∞—Ä—Å–µ")

# --- 5. –í–ê–® –ü–†–û–ú–ü–¢ (–°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø) ---
SYSTEM_PROMPT = f"""
–†–û–õ–¨: –¢—ã ‚Äî –º–µ—Ç–æ–¥–∏—Å—Ç –∏ –∫—Ä–µ–∞—Ç–æ—Ä –¥–µ—Ç—Å–∫–æ–π —à–∫–æ–ª—ã "Milky School".
–¢–í–û–Ø –ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞—Ç—å —Ä–∞–∑–≤–∏–≤–∞—é—â–µ–µ –∑–∞–¥–∞–Ω–∏–µ –Ω–∞ —Ç–µ–º—É "{user_topic}".
–¢–ò–ü –ó–ê–î–ê–ù–ò–Ø: {task_type}.
–°–õ–û–ñ–ù–û–°–¢–¨: {difficulty}.

–°–¢–ò–õ–¨ –ò –¢–û–ù:
- –ü–µ—Ä—Å–æ–Ω–∞–∂–∏: –ú–∏–ª–∫–∏ (–ø–∞–∫–µ—Ç –º–æ–ª–æ–∫–∞) –∏ –ü–µ—á–µ–Ω—å–∫–∞.
- –û–±—Ä–∞—â–µ–Ω–∏–µ: "–ú–∏–ª–∫–æ–ª–µ–Ω–æ–∫", "–¢—ã –≥–æ—Ç–æ–≤?", "–ü–æ–ª–µ—Ç–µ–ª–∏!".
- –°–µ—Ç—Ç–∏–Ω–≥: –ö–û–°–ú–û–° + –ò–°–õ–ê–ú (–†–∞–º–∞–¥–∞–Ω).

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê (–°—Ç—Ä–æ–≥–æ —Å–æ–±–ª—é–¥–∞–π –∑–∞–≥–æ–ª–æ–≤–∫–∏):

## ü™ê [–ü—Ä–∏–¥—É–º–∞–π –∫—Ä–µ–∞—Ç–∏–≤–Ω–æ–µ –Ω–∞–∑–≤–∞–Ω–∏–µ]

### üìù –¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞:
(–í–µ—Å–µ–ª–æ–µ –≤—Å—Ç—É–ø–ª–µ–Ω–∏–µ –æ—Ç –∏–º–µ–Ω–∏ –ú–∏–ª–∫–∏)

### üïå –ü–æ–ª–µ–∑–Ω–æ–µ –∑–Ω–∞–Ω–∏–µ (Fact-Check):
(–î–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–π –∏—Å–ª–∞–º—Å–∫–∏–π —Ñ–∞–∫—Ç –∏–ª–∏ —Ö–∞–¥–∏—Å, —É–ø—Ä–æ—â–µ–Ω–Ω—ã–π –¥–ª—è –¥–µ—Ç–µ–π).

### üõ†Ô∏è –ú–µ—Ö–∞–Ω–∏–∫–∞ –∑–∞–¥–∞–Ω–∏—è (–¢–ó):
(–ß—Ç–æ –∏–º–µ–Ω–Ω–æ –Ω—É–∂–Ω–æ –¥–µ–ª–∞—Ç—å: —Å–ø–∏—Å–æ–∫ —Å–ª–æ–≤, –ø—É—Ç—å –ª–∞–±–∏—Ä–∏–Ω—Ç–∞, –ø–∞—Ä—ã –¥–ª—è —Å–æ–µ–¥–∏–Ω–µ–Ω–∏—è).

### üé® –û–ø–∏—Å–∞–Ω–∏–µ –∫–∞—Ä—Ç–∏–Ω–∫–∏ (English Prompt):
(Black and white coloring page style, vector lines, no faces, space theme).
"""

# --- 6. –ö–ù–û–ü–ö–ê –ó–ê–ü–£–°–ö–ê ---
if st.button("üöÄ –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å", type="primary"):
    if not user_topic:
        st.warning("–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–º—É –∑–∞–¥–∞–Ω–∏—è!")
    else:
        with st.spinner("–ú–∏–ª–∫–∏ —Å–≤—è–∑—ã–≤–∞–µ—Ç—Å—è —Å —Ü–µ–Ω—Ç—Ä–æ–º —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è..."):
            try:
                # –°–æ–∑–¥–∞–µ–º –º–æ–¥–µ–ª—å (–°—Ç–∞–±–∏–ª—å–Ω—ã–π —Å–∏–Ω—Ç–∞–∫—Å–∏—Å)
                model = genai.GenerativeModel('gemini-1.5-flash')
                
                # –û—Ç–ø—Ä–∞–≤–ª—è–µ–º –∑–∞–ø—Ä–æ—Å
                response = model.generate_content(SYSTEM_PROMPT)
                
                # –í—ã–≤–æ–¥–∏–º —Ä–µ–∑—É–ª—å—Ç–∞—Ç
                st.success("–ì–æ—Ç–æ–≤–æ!")
                st.markdown(response.text)
                
            except Exception as e:
                st.error(f"–ü—Ä–æ–∏–∑–æ—à–ª–∞ –æ—à–∏–±–∫–∞: {e}")
