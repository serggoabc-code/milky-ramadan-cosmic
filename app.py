import streamlit as st
from google import genai 

# --- –ù–ê–°–¢–†–û–ô–ö–ò –°–¢–†–ê–ù–ò–¶–´ ---
st.set_page_config(page_title="Milky AI", page_icon="ü•õ", layout="wide")

# --- –ü–û–î–ö–õ–Æ–ß–ï–ù–ò–ï –ö –ú–û–ó–ì–£ ---
try:
    # –ò—Å–ø–æ–ª—å–∑—É–µ–º –Ω–æ–≤—É—é –±–∏–±–ª–∏–æ—Ç–µ–∫—É 2025 –≥–æ–¥–∞
    client = genai.Client(api_key=st.secrets["GOOGLE_API_KEY"])
except Exception as e:
    st.error(f"–û—à–∏–±–∫–∞ –∫–ª—é—á–∞: {e}")
    st.stop()

# --- –ò–ù–¢–ï–†–§–ï–ô–° ---
with st.sidebar:
    st.title("‚öôÔ∏è –ù–∞—Å—Ç—Ä–æ–π–∫–∏")
    task_type = st.selectbox("–¢–∏–ø –∑–∞–¥–∞–Ω–∏—è:", ["–õ–∞–±–∏—Ä–∏–Ω—Ç", "–ö—Ä–æ—Å—Å–≤–æ—Ä–¥", "–†–∞—Å–∫—Ä–∞—Å–∫–∞", "–õ–æ–≥–∏–∫–∞"])
    difficulty = st.select_slider("–°–ª–æ–∂–Ω–æ—Å—Ç—å:", ["–ú–∞–ª—ã—à–∏", "–®–∫–æ–ª—å–Ω–∏–∫–∏", "–ü–æ–¥—Ä–æ—Å—Ç–∫–∏"])

st.title("üöÄ Milky School: –ì–µ–Ω–µ—Ä–∞—Ç–æ—Ä (Gemini 3.0)")
user_topic = st.text_input("–¢–µ–º–∞ –∑–∞–¥–∞–Ω–∏—è:", placeholder="–ù–∞–ø—Ä–∏–º–µ—Ä: –¢–µ—Ä–ø–µ–Ω–∏–µ –≤ –∫–æ—Å–º–æ—Å–µ")

# --- –í–ê–® –ü–†–û–ú–ü–¢ (–°–ò–°–¢–ï–ú–ù–ê–Ø –ò–ù–°–¢–†–£–ö–¶–ò–Ø) ---
PROMPT = f"""
–†–û–õ–¨: –¢—ã ‚Äî –º–µ—Ç–æ–¥–∏—Å—Ç Milky School.
–°–¢–ò–õ–¨: –¢–æ–Ω –¥–æ–±—Ä—ã–π ("–ú–∏–ª–∫–æ–ª–µ–Ω–æ–∫"), –≥–µ—Ä–æ–∏ –ú–∏–ª–∫–∏ –∏ –ü–µ—á–µ–Ω—å–∫–∞. –¢–µ–º–∞: –ö–û–°–ú–û–° + –ò–°–õ–ê–ú.
–ó–ê–î–ê–ß–ê: –°–æ–∑–¥–∞–π –∑–∞–¥–∞–Ω–∏–µ "{task_type}" –Ω–∞ —Ç–µ–º—É "{user_topic}". –°–ª–æ–∂–Ω–æ—Å—Ç—å: {difficulty}.

–§–û–†–ú–ê–¢ –û–¢–í–ï–¢–ê:
## ü™ê [–ù–∞–∑–≤–∞–Ω–∏–µ]
### üìù –¢–µ–∫—Å—Ç –¥–ª—è —Ä–µ–±–µ–Ω–∫–∞:
(–ò–Ω—Å—Ç—Ä—É–∫—Ü–∏—è –æ—Ç –ú–∏–ª–∫–∏)
### üïå –§–∞–∫—Ç (Fact-Check):
(–ò—Å–ª–∞–º—Å–∫–∏–π —Ñ–∞–∫—Ç –∏–ª–∏ —Ö–∞–¥–∏—Å. –¢–æ–ª—å–∫–æ –¥–æ—Å—Ç–æ–≤–µ—Ä–Ω—ã–µ –∏—Å—Ç–æ—á–Ω–∏–∫–∏!)
### üõ†Ô∏è –ú–µ—Ö–∞–Ω–∏–∫–∞:
(–°—É—Ç—å –∑–∞–¥–∞–Ω–∏—è: —Å–ª–æ–≤–∞, –ø—É—Ç—å, –ø–∞—Ä—ã).
### üé® –ü—Ä–æ–º–ø—Ç –¥–ª—è –∫–∞—Ä—Ç–∏–Ω–∫–∏ (English):
(Black and white coloring page, vector lines, no faces, space theme).
"""

# --- –ö–ù–û–ü–ö–ê –ó–ê–ü–£–°–ö–ê ---
if st.button("–°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞—Ç—å"):
    if not user_topic:
        st.warning("–ù–∞–ø–∏—à–∏—Ç–µ —Ç–µ–º—É!")
    else:
        with st.spinner("–ó–∞–≥—Ä—É–∑–∫–∞ –∏–∑ –Ω–µ–π—Ä–æ—Å–µ—Ç–∏..."):
            try:
                # –í –∫–æ–¥–µ –∏—Å–ø–æ–ª—å–∑—É–µ–º 1.5, —Ç–∞–∫ –∫–∞–∫ API 3.0 –µ—â–µ –∑–∞–∫—Ä—ã—Ç –¥–ª—è –ø—É–±–ª–∏—á–Ω—ã—Ö –∫–ª—é—á–µ–π, 
                # –Ω–æ –∏–Ω—Ç–µ—Ä—Ñ–µ–π—Å —É–∂–µ –≥–æ—Ç–æ–≤ –∫ –±—É–¥—É—â–µ–º—É!
                response = client.models.generate_content(
                    model="gemini-1.5-flash", 
                    contents=PROMPT
                )
                st.success("–ì–æ—Ç–æ–≤–æ!")
                st.markdown(response.text)
            except Exception as e:
                st.error(f"–û—à–∏–±–∫–∞: {e}")
